---
# Usage:
#   The local site root / build directory must be specified on the command line using --extra-vars "root=".
#
- name: gameplaycolor.com
  hosts: gameplaycolor
  vars:

    port: 80
    domain: gameplaycolor.com
    aliases:
      - www2.gameplaycolor.com
    redirects:
      - www.gameplaycolor.com
    admin: support@inseven.co.uk
    directory_aliases:
      - path: "/app"
        target: "/var/www/app.gameplaycolor.com"
    build_dir: ../site/_site

  tasks:

    - name: create site directory
      file: path="/var/www/{{ domain }}" state=directory owner="{{ ansible_user_id }}" group="{{ ansible_user_id }}"
      become: yes

    - name: synchronize contents
      synchronize: src="{{ build_dir }}/" dest="/var/www/{{ domain }}/" delete=yes

    - name: create virtual host file
      template: src=virtualhost.conf dest="/etc/apache2/sites-available/{{ domain }}.conf"
      notify:
        - restart apache2
      become: yes

    - name: enable site
      command: a2ensite "{{ domain }}"
      args:
        creates: "/etc/apache2/sites-enabled/{{ domain }}.conf"
      notify:
        - restart apache2
      become: yes

  handlers:

    - name: restart apache2
      service: name=apache2 state=restarted
      become: yes
